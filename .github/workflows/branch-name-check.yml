name: Branch Name Validation

on:
  # pull_request:
  #   types: [opened, reopened, synchronize]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  branch-name-check:
    runs-on: ubuntu-latest

    steps:
      - name: Check branch name format
        shell: bash
        run: |
          BRANCH_NAME="${{ github.head_ref }}"

          echo "üîç Checking branch name: $BRANCH_NAME"

          # Allow main branch
          if [ "$BRANCH_NAME" = "main" ]; then
            echo "‚úÖ Branch name is valid: $BRANCH_NAME"
            exit 0
          fi

          # Check for valid prefixes: feature/, bugfix/, hotfix/, refactor/, docs/, test/, ci/, chore/, copilot/
          if [[ "$BRANCH_NAME" =~ ^(feature|bugfix|hotfix|refactor|docs|test|ci|chore|copilot)\/[a-z0-9._-]+$ ]]; then
            echo "‚úÖ Branch name is valid: $BRANCH_NAME"
            exit 0
          fi

          echo "‚ùå Branch name '$BRANCH_NAME' does not follow the naming convention."
          echo ""
          echo "Valid branch name prefixes:"
          echo "  - feature/    (for new features)"
          echo "  - bugfix/     (for bug fixes)"
          echo "  - hotfix/     (for hotfixes)"
          echo "  - refactor/   (for refactoring)"
          echo "  - docs/       (for documentation)"
          echo "  - test/       (for tests)"
          echo "  - ci/         (for CI/CD updates)"
          echo "  - chore/      (for chores and maintenance)"
          echo "  - copilot/    (for Copilot-generated changes)"
          echo ""
          echo "Examples of valid branch names:"
          echo "  - feature/add-pit-calculator"
          echo "  - bugfix/fix-tax-calculation"
          echo "  - docs/update-readme"
          echo "  - ci/add-github-actions"
          echo "  - chore/update-dependencies"
          echo "  - copilot/improve-functionality"
          exit 1
